P8105 HW5 jl6046
================
Brian Jo Hsuan Lee
2021-11-15

Load packages

``` r
library(tidyverse)
setwd("~/Desktop/Columbia/Fall_2021/P8105-Data_Science/HW/p8105_hw5_jl6046/")
```

Import and tidy dataset

``` r
hom_df = 
  read_csv("./data_files/homicide-data.csv", col_types = "cdccfdfffddf") %>% 
  unite(city_state, city, state, sep = ", ") %>% 
  mutate(
    city_state = factor(city_state),
    year = str_extract(reported_date, "^\\d{4}"),
    year = as.factor(year),
    month = str_extract(reported_date, "(?<=^....)\\d{2}"),
    month = month.name[as.numeric(month)],
    month = factor(month, levels = month.name[]),
    day = str_extract(reported_date, "\\d{2}$"),
    day = as.numeric(day)
  ) %>% 
  select(
    uid, year, month, day, everything(), -reported_date
  )
```

Create a homicide table

``` r
hom_sum_df = 
  hom_df %>% 
  group_by(city_state) %>% 
  summarize(tot_hom = n(),
            unsol_hom = sum(disposition != "Closed by arrest")) %>% 
  arrange(desc(tot_hom), desc(unsol_hom))

knitr::kable(
  hom_sum_df,
  format = "simple"
)
```

| city\_state        | tot\_hom | unsol\_hom |
|:-------------------|---------:|-----------:|
| Chicago, IL        |     5535 |       4073 |
| Philadelphia, PA   |     3037 |       1360 |
| Houston, TX        |     2942 |       1493 |
| Baltimore, MD      |     2827 |       1825 |
| Detroit, MI        |     2519 |       1482 |
| Los Angeles, CA    |     2257 |       1106 |
| St.Â Louis, MO      |     1677 |        905 |
| Dallas, TX         |     1567 |        754 |
| Memphis, TN        |     1514 |        483 |
| New Orleans, LA    |     1434 |        930 |
| Las Vegas, NV      |     1381 |        572 |
| Washington, DC     |     1345 |        589 |
| Indianapolis, IN   |     1322 |        594 |
| Kansas City, MO    |     1190 |        486 |
| Jacksonville, FL   |     1168 |        597 |
| Milwaukee, wI      |     1115 |        403 |
| Columbus, OH       |     1084 |        575 |
| Atlanta, GA        |      973 |        373 |
| Oakland, CA        |      947 |        508 |
| Phoenix, AZ        |      914 |        504 |
| San Antonio, TX    |      833 |        357 |
| Birmingham, AL     |      800 |        347 |
| Nashville, TN      |      767 |        278 |
| Miami, FL          |      744 |        450 |
| Cincinnati, OH     |      694 |        309 |
| Charlotte, NC      |      687 |        206 |
| Oklahoma City, OK  |      672 |        326 |
| San Francisco, CA  |      663 |        336 |
| Pittsburgh, PA     |      631 |        337 |
| New York, NY       |      627 |        243 |
| Boston, MA         |      614 |        310 |
| Tulsa, OK          |      583 |        193 |
| Louisville, KY     |      576 |        261 |
| Fort Worth, TX     |      549 |        255 |
| Buffalo, NY        |      521 |        319 |
| Fresno, CA         |      487 |        169 |
| San Diego, CA      |      461 |        175 |
| Stockton, CA       |      444 |        266 |
| Richmond, VA       |      429 |        113 |
| Baton Rouge, LA    |      424 |        196 |
| Omaha, NE          |      409 |        169 |
| Long Beach, CA     |      378 |        156 |
| Albuquerque, NM    |      378 |        146 |
| Sacramento, CA     |      376 |        139 |
| Minneapolis, MN    |      366 |        187 |
| Denver, CO         |      312 |        169 |
| Durham, NC         |      276 |        101 |
| San Bernardino, CA |      275 |        170 |
| Savannah, GA       |      246 |        115 |
| Tampa, FL          |      208 |         95 |
| Tulsa, AL          |        1 |          0 |

Compute the proportion of unresolved homicides in Baltimore

``` r
balt_hom_sum_df =
  hom_sum_df %>% 
  filter(city_state == "Baltimore, MD")

balt_test = 
  prop.test(pull(balt_hom_sum_df, unsol_hom), pull(balt_hom_sum_df, tot_hom)) %>% 
  broom::tidy()
```

Compute the proportion for all cities

``` r
city_prop_function = function(city){
  city_hom_sum_df =
    hom_sum_df %>% 
    filter(city_state == city)

  test = 
    prop.test(pull(city_hom_sum_df, unsol_hom), pull(city_hom_sum_df, tot_hom)) %>% 
    broom::tidy()
  
  return(test)
}

hom_test_df = 
  hom_sum_df %>% 
  mutate(
    test_res = map(city_state, city_prop_function)
  ) %>% 
  unnest(test_res) %>% 
  select(city_state, estimate, starts_with("conf"))
```

    ## Warning in prop.test(pull(city_hom_sum_df, unsol_hom), pull(city_hom_sum_df, :
    ## Chi-squared approximation may be incorrect
